<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯›æ¦‚è‡ªåŠ¨è¯»å–é¢˜åº“ç³»ç»Ÿ</title>
    <script src="question_data.js"></script> 
    
    <style>
        :root {
            --primary: #d9534f;
            --success: #5cb85c;
            --error: #d9534f;
            --bg: #f8f9fa;
        }
        body { font-family: "Microsoft YaHei", sans-serif; background: var(--bg); padding: 20px; line-height: 1.6; color:#333; }
        .container { max-width: 800px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        
        h1 { text-align: center; color: var(--primary); margin-bottom: 20px; }
        
        /* çŠ¶æ€æç¤º */
        #loading-msg { text-align: center; color: #666; padding: 50px; }
        #error-msg { text-align: center; color: var(--error); padding: 20px; display: none; border: 2px dashed var(--error); border-radius: 5px;}

        .control-bar { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px; display: none; }
        
        .question-card { margin-bottom: 25px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 6px; background: #fff; transition: box-shadow 0.2s; }
        .question-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        .type-tag { display: inline-block; padding: 2px 8px; border-radius: 4px; color: white; font-size: 12px; margin-right: 8px; vertical-align: 2px; }
        .tag-single { background-color: #5bc0de; }
        .tag-multi { background-color: #f0ad4e; }
        .tag-judge { background-color: #5cb85c; }

        .q-title { font-weight: bold; font-size: 16px; margin-bottom: 15px; }

        .option-item { margin: 8px 0; padding: 10px 15px; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; display: flex; align-items: center; transition: background 0.2s; }
        .option-item:hover { background-color: #f5f5f5; }
        
        /* é€‰ä¸­/å¯¹é”™æ ·å¼ */
        .option-item.selected { background-color: #e8f4fd; border-color: #2196F3; }
        .option-item.correct { background-color: #dff0d8; border-color: var(--success); color: #3c763d; font-weight: bold; }
        .option-item.wrong { background-color: #f2dede; border-color: var(--error); color: #a94442; }

        .btn { padding: 8px 20px; border-radius: 4px; border: none; cursor: pointer; font-size: 14px; outline: none; }
        .btn-refresh { background: var(--primary); color: white; }
        .btn-submit { background: #337ab7; color: white; margin-top: 10px; }
        
        .feedback { margin-top: 10px; padding: 10px; background: #fafafa; border-radius: 4px; display: none; font-size: 14px; }
        
        .score-board { position: fixed; bottom: 20px; right: 20px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.15); font-size: 14px; z-index: 100; display: none;}
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“ æ¯›æ¦‚æ™ºèƒ½åˆ·é¢˜</h1>

    <div id="loading-msg">æ­£åœ¨è¯»å–é¢˜åº“...</div>
    
    <div id="error-msg">
        <h3>âš ï¸ æœªæ‰¾åˆ°é¢˜åº“æ–‡ä»¶</h3>
        <p>è¯·ç¡®ä¿ <b>question_data.js</b> æ–‡ä»¶å­˜åœ¨ï¼Œä¸”ä¸æœ¬ HTML æ–‡ä»¶åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚</p>
        <p>è¯·å…ˆè¿è¡Œ Python è„šæœ¬ç”Ÿæˆè¯¥æ–‡ä»¶ã€‚</p>
    </div>

    <div id="main-interface" style="display:none;">
        <div class="control-bar">
            <span>å½“å‰æ¨¡å¼ï¼šéšæœºæŠ½å– <b>15å• + 15å¤š + 15åˆ¤</b> (å…±45é¢˜)</span>
            <button class="btn btn-refresh" onclick="initQuiz()">ğŸ”„ æ¢ä¸€æ‰¹é¢˜</button>
        </div>
        <div id="quiz-area"></div>
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn btn-refresh" onclick="window.scrollTo(0,0); initQuiz()">å†æ¥ä¸€å¥—</button>
        </div>
    </div>
</div>

<div class="score-board" id="score-board">
    <div><b>ç­”é¢˜ç»Ÿè®¡</b></div>
    <hr style="margin: 5px 0; border:0; border-top:1px solid #eee;">
    <div>å·²ç­”ï¼š<span id="answered-count">0</span> / 45</div>
    <div>æ­£ç¡®ï¼š<span id="correct-count" style="color:green">0</span></div>
    <div>é”™è¯¯ï¼š<span id="wrong-count" style="color:red">0</span></div>
</div>

<script>
    // å…¨å±€å˜é‡
    let currentQuestions = [];
    let stats = { answered: 0, correct: 0, wrong: 0 };

    // 1. åˆå§‹åŒ–æ£€æŸ¥
    window.onload = function() {
        const loading = document.getElementById('loading-msg');
        const error = document.getElementById('error-msg');
        const main = document.getElementById('main-interface');
        const scoreBoard = document.getElementById('score-board');

        // æ£€æŸ¥ Python ç”Ÿæˆçš„å…¨å±€å˜é‡æ˜¯å¦å­˜åœ¨
        if (typeof window.QUESTION_BANK !== 'undefined' && Array.isArray(window.QUESTION_BANK)) {
            loading.style.display = 'none';
            main.style.display = 'block';
            scoreBoard.style.display = 'block';
            initQuiz();
        } else {
            loading.style.display = 'none';
            error.style.display = 'block';
        }
    };

    // 2. æŠ½é¢˜é€»è¾‘
    function initQuiz() {
        // é‡ç½®ç»Ÿè®¡
        stats = { answered: 0, correct: 0, wrong: 0 };
        updateScoreBoard();
        
        const allData = window.QUESTION_BANK;
        
        // åˆ†ç±»
        const singles = allData.filter(q => q.type === 'å•é€‰');
        const multis = allData.filter(q => q.type === 'å¤šé€‰');
        const judges = allData.filter(q => q.type === 'åˆ¤æ–­');

        // éšæœºæŠ½å– (æ´—ç‰Œç®—æ³•)
        function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }

        // å¦‚æœé¢˜ç›®ä¸å¤Ÿï¼Œåˆ™å…¨éƒ¨å–å‡º
        const selectedSingles = shuffle(singles).slice(0, 15);
        const selectedMultis = shuffle(multis).slice(0, 15);
        const selectedJudges = shuffle(judges).slice(0, 15);

        // åˆå¹¶
        currentQuestions = [...selectedSingles, ...selectedMultis, ...selectedJudges];

        renderQuestions();
    }

    // 3. æ¸²æŸ“é¢˜ç›®
    function renderQuestions() {
        const area = document.getElementById('quiz-area');
        area.innerHTML = '';

        if (currentQuestions.length === 0) {
            area.innerHTML = '<p style="text-align:center">é¢˜åº“ä¸ºç©ºï¼Œè¯·æ£€æŸ¥æ•°æ®ã€‚</p>';
            return;
        }

        currentQuestions.forEach((q, index) => {
            const card = document.createElement('div');
            card.className = 'question-card';
            card.dataset.answer = q.answer; // å­˜å‚¨æ­£ç¡®ç­”æ¡ˆ
            card.dataset.type = q.type;

            // é¢˜å‹æ ‡ç­¾é¢œè‰²
            let tagClass = 'tag-single';
            if (q.type === 'å¤šé€‰') tagClass = 'tag-multi';
            if (q.type === 'åˆ¤æ–­') tagClass = 'tag-judge';

            // æ„å»º HTML
            let html = `
                <div class="q-title">
                    <span class="type-tag ${tagClass}">${q.type}</span>
                    ${index + 1}. ${q.title}
                </div>
                <div class="options-group">
            `;

            // æ¸²æŸ“é€‰é¡¹
            if (q.type === 'åˆ¤æ–­') {
                html += `
                    <div class="option-item" onclick="handleOptionClick(this, 'æ­£ç¡®')">âœ”ï¸ æ­£ç¡®</div>
                    <div class="option-item" onclick="handleOptionClick(this, 'é”™è¯¯')">âŒ é”™è¯¯</div>
                `;
            } else {
                ['A', 'B', 'C', 'D'].forEach(key => {
                    if (q.options[key]) {
                        html += `
                            <div class="option-item" onclick="handleOptionClick(this, '${key}')">
                                <span style="font-weight:bold; width:25px;">${key}.</span> ${q.options[key]}
                            </div>
                        `;
                    }
                });
            }

            html += `</div>`;

            // å¤šé€‰éœ€è¦æäº¤æŒ‰é’®
            if (q.type === 'å¤šé€‰') {
                html += `<button class="btn btn-submit" onclick="submitMulti(this)">ç¡®è®¤ç­”æ¡ˆ</button>`;
            }

            // åé¦ˆåŒºåŸŸ
            html += `<div class="feedback"></div>`;

            card.innerHTML = html;
            area.appendChild(card);
        });
    }

    // 4. äº¤äº’é€»è¾‘
    
    // ç‚¹å‡»é€‰é¡¹ (å•é€‰/åˆ¤æ–­/å¤šé€‰çš„é€‰ä¸­)
    window.handleOptionClick = function(el, value) {
        const card = el.closest('.question-card');
        const type = card.dataset.type;

        // å¦‚æœå·²ç­”é¢˜(å•é€‰/åˆ¤æ–­)ï¼Œæˆ–è€…æ˜¯å¤šé€‰å·²æäº¤ï¼Œåˆ™ç¦æ­¢æ“ä½œ
        if (card.classList.contains('answered')) return;

        if (type === 'å¤šé€‰') {
            // å¤šé€‰ï¼šåˆ‡æ¢é€‰ä¸­çŠ¶æ€
            el.classList.toggle('selected');
        } else {
            // å•é€‰/åˆ¤æ–­ï¼šç›´æ¥æäº¤
            card.classList.add('answered');
            checkAnswer(card, value, el);
        }
    };

    // æäº¤å¤šé€‰
    window.submitMulti = function(btn) {
        const card = btn.closest('.question-card');
        if (card.classList.contains('answered')) return;

        // è·å–æ‰€æœ‰é€‰ä¸­çš„é€‰é¡¹
        const selectedEls = card.querySelectorAll('.option-item.selected');
        const userAns = Array.from(selectedEls).map(el => {
            // æå–é€‰é¡¹ A, B...
            return el.innerText.trim().charAt(0);
        }).sort().join('');

        if (userAns.length === 0) return; // æœªé€‰ä»»ä½•é¡¹

        card.classList.add('answered');
        btn.style.display = 'none'; // éšè—æŒ‰é’®
        
        checkAnswer(card, userAns, null);
    };

    // æ ¸å¿ƒåˆ¤é¢˜å‡½æ•°
    function checkAnswer(card, userAns, clickedEl) {
        const correctAns = card.dataset.answer;
        const feedback = card.querySelector('.feedback');
        const type = card.dataset.type;
        const options = card.querySelectorAll('.option-item');

        let isCorrect = (userAns === correctAns);

        stats.answered++;
        
        if (isCorrect) {
            stats.correct++;
            feedback.innerHTML = `âœ… <b>å›ç­”æ­£ç¡®ï¼</b>`;
            feedback.style.color = 'green';
            feedback.style.display = 'block';
            
            // é«˜äº®æ­£ç¡®é¡¹
            if (type === 'å¤šé€‰') {
                options.forEach(opt => {
                    if (opt.classList.contains('selected')) opt.classList.add('correct');
                });
            } else {
                if(clickedEl) clickedEl.classList.add('correct');
            }

        } else {
            stats.wrong++;
            feedback.innerHTML = `âŒ <b>å›ç­”é”™è¯¯</b><br>æ­£ç¡®ç­”æ¡ˆï¼š<b>${correctAns}</b>`;
            feedback.style.color = '#d9534f';
            feedback.style.display = 'block';

            // æ ·å¼å¤„ç†
            if (type === 'å¤šé€‰') {
                options.forEach(opt => {
                    if (opt.classList.contains('selected')) opt.classList.add('wrong');
                });
            } else {
                if(clickedEl) clickedEl.classList.add('wrong');
            }
            
            // æ ‡å‡ºæ­£ç¡®ç­”æ¡ˆ (ç»¿è‰²é«˜äº®)
            if (type === 'åˆ¤æ–­') {
                options.forEach(opt => {
                    if (opt.innerText.includes(correctAns === 'æ­£ç¡®' ? 'âœ”ï¸' : 'âŒ')) {
                        opt.classList.add('correct');
                    }
                });
            } else {
                // å•é€‰/å¤šé€‰ æ ‡å‡ºæ‰€æœ‰åŒ…å«åœ¨æ­£ç¡®ç­”æ¡ˆé‡Œçš„é€‰é¡¹
                options.forEach(opt => {
                    const letter = opt.innerText.trim().charAt(0);
                    if (correctAns.includes(letter)) {
                        opt.classList.add('correct');
                    }
                });
            }
        }
        updateScoreBoard();
    }

    function updateScoreBoard() {
        document.getElementById('answered-count').innerText = stats.answered;
        document.getElementById('correct-count').innerText = stats.correct;
        document.getElementById('wrong-count').innerText = stats.wrong;
    }

</script>

</body>
</html>
