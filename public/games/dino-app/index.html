<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dino Run</title>
    <style>
        :root {
            --bg-color: #f7f7f7;
            --text-color: #535353;
            --accent: #535353;
            --font: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            transition: background 0.5s, color 0.5s;
            touch-action: none;
            user-select: none;
        }

        /* ÈúìËôπ‰∏ªÈ¢ò */
        body.theme-neon {
            --bg-color: #0a0a0a;
            --text-color: #00ffcc;
            --accent: #ff00ff;
        }
        body.theme-neon canvas {
            box-shadow: 0 0 20px rgba(0, 255, 204, 0.2);
            border: 1px solid #333;
        }

        .header {
            position: absolute; top: 20px; width: 100%;
            display: flex; justify-content: center; gap: 20px;
            z-index: 10;
        }

        .btn {
            background: transparent;
            border: 2px solid var(--text-color);
            color: var(--text-color);
            padding: 5px 15px;
            font-family: inherit;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .btn:hover {
            background: var(--text-color);
            color: var(--bg-color);
        }

        canvas {
            display: block;
            width: 100%;
            max-width: 800px;
            height: 300px;
            border-bottom: 2px solid var(--text-color);
        }

        #overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        #overlay.hidden { display: none; }
        
        h1 { font-size: 2rem; margin-bottom: 10px; }
        .blink { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        @media (max-width: 600px) {
            canvas { height: 250px; }
        }
    </style>
</head>
<body class="theme-classic">

    <div class="header">
        <button class="btn" onclick="toggleTheme()">üé® Style Switch</button>
        <div style="font-size: 1.5rem; font-weight: bold;" id="score">00000</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="overlay">
        <h1 id="msg">PRESS SPACE</h1>
        <p class="blink">Tap to Jump</p>
    </div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const overlay = document.getElementById('overlay');
    const msg = document.getElementById('msg');

    // ÈÖçÁΩÆ
    let theme = 'classic';
    let gameRunning = false;
    let gameSpeed = 6;
    let score = 0;
    let frame = 0;
    let highScore = localStorage.getItem('dino_best') || 0;

    // ÂÆû‰Ωì
    const dino = {
        x: 50, y: 0, w: 40, h: 40,
        dy: 0, jumpForce: 12, gravity: 0.6,
        grounded: false, ducking: false,
        legFrame: 0 // Ë∑ëÊ≠•Âä®ÁîªÂ∏ß
    };
    
    let obstacles = []; // {type: 'cactus'|'bird', x, y, w, h}
    let clouds = [];

    function resize() {
        // Âõ∫ÂÆöÈÄªËæëÂàÜËæ®ÁéáÔºåËßÜËßâ‰∏äÊãâ‰º∏
        canvas.width = 800;
        canvas.height = 300;
        dino.groundY = canvas.height - 20;
    }
    window.addEventListener('resize', resize);
    resize();

    function toggleTheme() {
        if (theme === 'classic') {
            theme = 'neon';
            document.body.className = 'theme-neon';
        } else {
            theme = 'classic';
            document.body.className = 'theme-classic';
        }
        draw(); // ÈáçÁªòÈùôÊÄÅÁîªÈù¢
    }

    function initGame() {
        obstacles = [];
        clouds = [];
        score = 0;
        gameSpeed = 6;
        dino.y = dino.groundY - dino.h;
        dino.dy = 0;
        gameRunning = true;
        overlay.classList.add('hidden');
        requestAnimationFrame(loop);
    }

    function jump() {
        if (!gameRunning) {
            initGame();
            return;
        }
        if (dino.grounded) {
            dino.dy = -dino.jumpForce;
            dino.grounded = false;
        }
    }

    function duck(isDown) {
        if (!gameRunning) return;
        if (isDown) {
            if (!dino.ducking) {
                dino.h = 20; // ÂèòÁüÆ
                dino.y += 20;
                dino.ducking = true;
                dino.dy += 5; // Âø´ÈÄü‰∏ãÂù†
            }
        } else {
            if (dino.ducking) {
                dino.y -= 20;
                dino.h = 40; // ÊÅ¢Â§ç
                dino.ducking = false;
            }
        }
    }

    // ËæìÂÖ•
    document.addEventListener('keydown', e => {
        if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); jump(); }
        if (e.code === 'ArrowDown') { e.preventDefault(); duck(true); }
    });
    document.addEventListener('keyup', e => {
        if (e.code === 'ArrowDown') duck(false);
    });
    document.addEventListener('touchstart', e => {
        e.preventDefault();
        jump(); // ÁßªÂä®Á´ØÁÆÄÂåñ‰∏∫ÁÇπÂáªË∑≥Ë∑É
    }, {passive: false});

    function loop() {
        if (!gameRunning) return;

        update();
        draw();
        requestAnimationFrame(loop);
    }

    function update() {
        frame++;
        score++;
        scoreEl.innerText = Math.floor(score/5).toString().padStart(5, '0');
        
        // Âä†ÈÄü
        if (score % 500 === 0) gameSpeed += 0.5;

        // Dino Áâ©ÁêÜ
        dino.y += dino.dy;
        if (dino.y < dino.groundY - dino.h) {
            dino.dy += dino.gravity;
            dino.grounded = false;
        } else {
            dino.y = dino.groundY - dino.h;
            dino.dy = 0;
            dino.grounded = true;
        }

        // Ë∑ëÊ≠•Âä®Áîª
        if (frame % 5 === 0) dino.legFrame = !dino.legFrame;

        // ÁîüÊàêÈöúÁ¢çÁâ©
        if (frame % 100 === 0) { // Âü∫Á°ÄÁîüÊàêÁéá
            if (Math.random() < 0.5) spawnObstacle();
        }
        // ÈöèÊú∫È¢ùÂ§ñÁîüÊàê
        if (Math.random() < 0.01) spawnObstacle();

        // ÈöúÁ¢çÁâ©ÁßªÂä®‰∏éÁ¢∞Êíû
        for (let i = obstacles.length - 1; i >= 0; i--) {
            let obs = obstacles[i];
            obs.x -= gameSpeed;

            // Á¢∞ÊíûÊ£ÄÊµã (AABB)
            // Áº©Â∞è‰∏ÄÁÇπ hitbox Â¢ûÂä†ÂÆπÈîô
            if (
                dino.x < obs.x + obs.w - 5 &&
                dino.x + dino.w - 5 > obs.x &&
                dino.y < obs.y + obs.h - 5 &&
                dino.y + dino.h - 5 > obs.y
            ) {
                gameOver();
            }

            if (obs.x + obs.w < 0) obstacles.splice(i, 1);
        }
        
        // ÁÆÄÂçïÁöÑÈò≤ÈáçÂè†ÈÄªËæë
        // (ÂÆûÈôÖ‰ª£Á†Å‰∏≠Â∫îÊ£ÄÊü•ÊúÄÂêé‰∏Ä‰∏™ÈöúÁ¢çÁâ©ÁöÑË∑ùÁ¶ª)
        
        // ‰∫ëÊúµ
        if (frame % 150 === 0) {
            clouds.push({x: canvas.width, y: Math.random()*100, w: 40});
        }
        clouds.forEach(c => c.x -= gameSpeed * 0.2);
        clouds = clouds.filter(c => c.x + c.w > -50);
    }

    function spawnObstacle() {
        // Á°Æ‰øùË∑ùÁ¶ªÂ§üËøú
        if (obstacles.length > 0) {
            let last = obstacles[obstacles.length-1];
            if (800 - last.x < 250) return; // ÊúÄÂ∞èÈó¥Ë∑ù
        }

        let type = Math.random();
        if (type < 0.2 && score > 500) { 
            // ÁøºÈæô (È£û)
            let height = Math.random() < 0.5 ? 50 : 10; // È´òÈ£ûÊàñ‰ΩéÈ£û
            obstacles.push({ type: 'bird', x: 800, y: dino.groundY - 40 - height, w: 40, h: 30 });
        } else {
            // ‰ªô‰∫∫Êéå (Âú∞)
            let w = Math.random() < 0.5 ? 20 : 45; // Âçï‰∏™ÊàñÂ§ö‰∏™
            let h = Math.random() < 0.5 ? 35 : 50; // Â§ßÊàñÂ∞è
            obstacles.push({ type: 'cactus', x: 800, y: dino.groundY - h, w: w, h: h });
        }
    }

    function gameOver() {
        gameRunning = false;
        if (Math.floor(score/5) > highScore) {
            highScore = Math.floor(score/5);
            localStorage.setItem('dino_best', highScore);
        }
        msg.innerText = "GAME OVER";
        overlay.classList.remove('hidden');
    }

    // --- ÁªòÂà∂Á≥ªÁªü (ÂÉèÁ¥†È£éÊ®°Êãü) ---
    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        const color = theme === 'neon' ? '#00ffcc' : '#535353';
        const accent = theme === 'neon' ? '#ff00ff' : '#535353';
        
        ctx.fillStyle = color;
        ctx.strokeStyle = color;

        // Âú∞Èù¢
        ctx.beginPath();
        ctx.moveTo(0, dino.groundY);
        ctx.lineTo(canvas.width, dino.groundY);
        ctx.lineWidth = 2;
        ctx.stroke();

        // ‰∫ëÊúµ
        clouds.forEach(c => {
            ctx.globalAlpha = 0.5;
            ctx.fillRect(c.x, c.y, c.w, 10);
            ctx.fillRect(c.x+10, c.y-10, c.w-10, 10);
            ctx.globalAlpha = 1;
        });

        // ÊÅêÈæô
        if (theme === 'classic') {
            // ÁÆÄÂçïÁöÑÂÉèÁ¥†ÂùóÊ®°ÊãüÊÅêÈæô
            ctx.fillRect(dino.x, dino.y, dino.w, dino.h);
            // ÁúºÁùõ
            ctx.fillStyle = '#fff';
            ctx.fillRect(dino.x + 25, dino.y + 5, 5, 5);
            ctx.fillStyle = color;
            // ËÖø
            if (dino.grounded) {
                if (dino.legFrame) ctx.clearRect(dino.x, dino.y + dino.h - 5, 15, 5);
                else ctx.clearRect(dino.x + 25, dino.y + dino.h - 5, 15, 5);
            }
        } else {
            // Neon È£éÊ†ºÔºöÁ∫øÊ°Ü
            ctx.shadowBlur = 10; ctx.shadowColor = color;
            ctx.strokeRect(dino.x, dino.y, dino.w, dino.h);
            ctx.beginPath();
            ctx.moveTo(dino.x, dino.y); ctx.lineTo(dino.x+dino.w, dino.y+dino.h);
            ctx.stroke();
            ctx.shadowBlur = 0;
        }

        // ÈöúÁ¢çÁâ©
        obstacles.forEach(o => {
            if (o.type === 'cactus') {
                ctx.fillStyle = accent;
                if (theme === 'neon') {
                    ctx.shadowBlur = 10; ctx.shadowColor = accent;
                    ctx.strokeRect(o.x, o.y, o.w, o.h);
                } else {
                    // ÁªèÂÖ∏‰ªô‰∫∫ÊéåÁîªÊ≥ï (ÁÆÄÂçïÁöÑÊü±Â≠ê)
                    ctx.fillRect(o.x + o.w/3, o.y, o.w/3, o.h); // ‰∏ªÂπ≤
                    ctx.fillRect(o.x, o.y + 10, o.w, 10); // ÂàÜÂèâ
                }
                ctx.shadowBlur = 0;
            } else {
                // ÁøºÈæô
                ctx.fillStyle = color;
                let wingY = (frame % 20 < 10) ? 0 : 10;
                ctx.fillRect(o.x, o.y + 10, o.w, 10); // Ë∫´‰Ωì
                ctx.fillRect(o.x + 10, o.y + wingY, 10, 10); // ÁøÖËÜÄ
            }
        });
        
        // ÊÅ¢Â§çÈ¢úËâ≤
        ctx.fillStyle = color;
    }
    
    // ÂàùÂßãÁîªÈù¢
    draw();

</script>
</body>
</html>
